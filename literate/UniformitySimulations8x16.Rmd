---
title: "Uniformity Simulations"
author: "Peter Claussen"
date: "May 18, 2016"
output: html_document
---


Multiple Trial Simulations
--------------------------

```{r}
currentwd <- getwd()
setwd("~/Work/git/ASA_CSSA_SSSA/ASA_CSSA_SSSA/R")
source("pair.distances.R")
source("plot.distance.R")
source("superimpose.plan.R")
source("simulate.plan.R")
source("trial.dimensions.R")
setwd(currentwd)

arm.plot.dim <- c(4,6)
arm.row.buffer <- c(0.5,1)
checks <- 97:100
unreplicated <- 1:96
```

```{r}
library(ggplot2)
```

Assume we have yield (or other agronomic assessment) data in spatial format, such as yield monitor data.
For example, this data from the SDSU research statio near Beresford. This file has been edited from the original format and is comma-seperated.

```{r}
raw.dat <- read.csv("./data/sdsu/Swest_Corn2013-Clean.csv", header = TRUE)

response <- "YldVolDry"
hist(raw.dat[,response],main=response)

minLon <- min(raw.dat$Longitude)
maxLon <- max(raw.dat$Longitude)
minLat <- min(raw.dat$Latitude)
maxLat <- max(raw.dat$Latitude)

northBorder <- maxLat - 0.06*(maxLat-minLat)
southBorder <- minLat + 0.09*(maxLat-minLat)
eastBorder <- maxLon - 0.02*(maxLon-minLon)
westBorder <- minLon + 0.02*(maxLon-minLon)

trimmed.dat <- subset(raw.dat,raw.dat$Latitude>=southBorder)
trimmed.dat <- subset(trimmed.dat,trimmed.dat$Latitude<=northBorder)
trimmed.dat <- subset(trimmed.dat,trimmed.dat$Longitude<=eastBorder)
trimmed.dat <- subset(trimmed.dat,trimmed.dat$Longitude>=westBorder)

ggplot(trimmed.dat, aes(Longitude, Latitude)) + geom_point(aes(colour = YldVolDry),size = 1)
```

Now, let's map a trial into one corner of the field. We will find this easier if we convert to meters. 
This will require an approximation, see http://stackoverflow.com/questions/639695/how-to-convert-latitude-or-longitude-to-meters

```{r}
trimmed.dat$LonM <- trimmed.dat$Longitude - min(trimmed.dat$Longitude)
trimmed.dat$LatM <- trimmed.dat$Latitude - min(trimmed.dat$Latitude)
latMid <- (min(trimmed.dat$Latitude) + max(trimmed.dat$Latitude))/2
m_per_deg_lat = 111132.954 - 559.822 * cos( 2.0 * latMid ) + 1.175 * cos( 4.0 * latMid)
m_per_deg_lon = (3.14159265359/180 ) * 6367449 * cos ( latMid )
trimmed.dat$LonM <- trimmed.dat$LonM*m_per_deg_lon
trimmed.dat$LatM <- trimmed.dat$LatM*m_per_deg_lat
ggplot(trimmed.dat, aes(LonM, LatM)) + geom_point(aes(colour = YldVolDry),size = 1)
```


```{r}
library(gstat)
sample.var <- variogram(YldVolDry~1, 
                        locations=~LonM+LatM, 
                        data=trimmed.dat)
plot(sample.var)
sample.vgm <- fit.variogram(sample.var, vgm("Exp"))
sample.vgm
```

### Simulation


```{r}
library(nlme)
```


### Block Size 16
Stagger 0

```{r}
aug8x16.plan <- data.frame(
row=c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
      2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
      3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
      4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
      5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
      6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
      7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
      8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8),
col=c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,
      1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,
      1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,
      1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,
      1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,
      1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,
      1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,
      1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16)
)
aug8x16.plan$blk <- aug8x16.plan$row
```


```{r}
aug8x16adj0nonran1.plan <- aug8x16.plan
aug8x16adj0nonran1.plan$trt <- c(99, 1, 2, 3, 97, 4, 5, 6, 100, 7, 8, 9, 98, 10, 11, 12, 100, 13, 14, 15, 98, 16, 17, 18, 99, 19, 20, 21, 97, 22, 23, 24, 98, 25, 26, 27, 97, 28, 29, 30, 99, 31, 32, 33, 100, 34, 35, 36, 97, 37, 38, 39, 100, 40, 41, 42, 98, 43, 44, 45, 99, 46, 47, 48, 100, 49, 50, 51, 99, 52, 53, 54, 97, 55, 56, 57, 98, 58, 59, 60, 97, 61, 62, 63, 100, 64, 65, 66, 98, 67, 68, 69, 99, 70, 71, 72, 98, 73, 74, 75, 99, 76, 77, 78, 97, 79, 80, 81, 100, 82, 83, 84, 99, 85, 86, 87, 98, 88, 89, 90, 100, 91, 92, 93, 97, 94, 95, 96)

trial.dimensions(aug8x16.plan,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer)

aug8x16adj0nonran1.sim <- simulate.plan(aug8x16adj0nonran1.plan,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)
```

```{r}
aug8x16adj0nonran1.sim$points$check <- as.factor(aug8x16adj0nonran1.sim$points$trt %in% checks)

ggplot(aug8x16adj0nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = YldVolDry),size=1)
ggplot(aug8x16adj0nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = trt),size=1)
ggplot(aug8x16adj0nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = check),size=1)
```

### Stagger 0, centered
```{r}
aug8x16adj0nonran0.plan <- aug8x16.plan
aug8x16adj0nonran0.plan$trt <- c(1, 2, 99, 3, 4, 5, 97, 6, 7, 8, 100, 9, 10, 11, 98, 12, 13, 14, 100, 15, 16, 17, 98, 18, 19, 20, 99, 21, 22, 23, 97, 24, 25, 26, 98, 27, 28, 29, 97, 30, 31, 32, 99, 33, 34, 35, 100, 36, 37, 38, 97, 39, 40, 41, 100, 42, 43, 44, 98, 45, 46, 47, 99, 48, 49, 50, 100, 51, 52, 53, 99, 54, 55, 56, 97, 57, 58, 59, 98, 60, 61, 62, 97, 63, 64, 65, 100, 66, 67, 68, 98, 69, 70, 71, 99, 72, 73, 74, 98, 75, 76, 77, 99, 78, 79, 80, 97, 81, 82, 83, 100, 84, 85, 86, 99, 87, 88, 89, 98, 90, 92, 91, 100, 93, 94, 95, 97, 96)

aug8x16adj0nonran0.sim <- simulate.plan(aug8x16adj0nonran0.plan,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)
aug8x16adj0nonran0.sim$points$check <- as.factor(aug8x16adj0nonran0.sim$points$trt %in% checks)
ggplot(aug8x16adj0nonran0.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = check),size=1)
```

```{r}
aug8x16adj0nonran0b.plan <- aug8x16.plan
aug8x16adj0nonran0b.plan$trt <- c(1, 2, 99, 3, 4, 5, 97, 6, 7, 8, 100, 9, 10, 11, 98, 12, 13, 100, 14, 15, 16, 98, 17, 18, 19, 99, 20, 21, 22, 97, 23, 24, 25, 26, 98, 27, 28, 29, 97, 30, 31, 32, 99, 33, 34, 35, 100, 36, 37, 97, 38, 39, 40, 100, 41, 42, 43, 98, 44, 45, 46, 99, 47, 48, 49, 50, 100, 51, 52, 53, 99, 54, 55, 56, 97, 57, 58, 59, 98, 60, 61, 97, 62, 63, 64, 100, 65, 66, 67, 98, 68, 69, 70, 99, 71, 72, 73, 74, 98, 75, 76, 77, 99, 78, 79, 80, 97, 81, 82, 83, 100, 84, 85, 99, 86, 87, 88, 98, 89, 90, 91, 100, 92, 93, 94, 97, 95, 96)

aug8x16adj0nonran0b.sim <- simulate.plan(aug8x16adj0nonran0b.plan,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)
aug8x16adj0nonran0b.sim$points$check <- as.factor(aug8x16adj0nonran0b.sim$points$trt %in% checks)
ggplot(aug8x16adj0nonran0b.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = check),size=1)
```

Stagger 1
---------

```{r}
aug8x16adj1nonran1.plan <- aug8x16.plan
#aug8x16adj1nonran1.plan$trt <- c(99, 1, 2, 3, 97, 4, 5, 6, 100, 7, 8, 9, 98, 10, 11, 12, 24, 100, 13, 14, 15, 98, 16, 17, 18, 99, 19, 20, 21, 97, 22, 23, 35, 36, 98, 25, 26, 27, 97, 28, 29, 30, 99, 31, 32, 33, 100, 34, 46, 47, 48, 97, 37, 38, 39, 100, 40, 41, 42, 98, 43, 44, 45, 99, 98, 58, 59, 60, 100, 49, 50, 51, 99, 52, 53, 54, 97, 55, 56, 57, 69, 99, 70, 71, 72, 97, 61, 62, 63, 100, 64, 65, 66, 98, 67, 68, 80, 81, 100, 82, 83, 84, 98, 73, 74, 75, 99, 76, 77, 78, 97, 79, 91, 92, 93, 97, 94, 95, 96, 99, 85, 86, 87, 98, 88, 89, 90, 100)
aug8x16adj1nonran1.plan$trt <- c(99, 1, 2, 3, 97, 4, 5, 6, 100, 7, 8, 9, 98, 10, 11, 12, 24, 100, 13, 14, 15, 98, 16, 17, 18, 99, 19, 20, 21, 97, 22, 23, 35, 36, 98, 25, 26, 27, 97, 28, 29, 30, 99, 31, 32, 33, 100, 34, 46, 47, 48, 97, 37, 38, 39, 100, 40, 41, 42, 98, 43, 44, 45, 99, 100, 58, 59, 60, 99, 49, 50, 51, 97, 52, 53, 54, 98, 55, 56, 57, 69, 97, 70, 71, 72, 100, 61, 62, 63, 98, 64, 65, 66, 99, 67, 68, 80, 81, 98, 82, 83, 84, 99, 73, 74, 75, 97, 76, 77, 78, 100, 79, 91, 92, 93, 99, 94, 95, 96, 98, 85, 86, 87, 100, 88, 89, 90, 97)
aug8x16adj1nonran1.sim <- simulate.plan(aug8x16adj1nonran1.plan,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)
```

```{r}
aug8x16adj1nonran1.sim$points$check <- as.factor(aug8x16adj1nonran1.sim$points$trt %in% checks)
ggplot(aug8x16adj1nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = trt),size=1)
ggplot(aug8x16adj1nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = check),size=1)
```

Stagger 2

```{r}
aug8x16adj2nonran1.plan <- aug8x16.plan
#aug8x16adj2nonran1.plan$trt <- c(99, 1, 2, 3, 97, 4, 5, 6, 100, 7, 8, 9, 98, 10, 11, 12, 23, 24, 100, 13, 14, 15, 98, 16, 17, 18, 99, 19, 20, 21, 97, 22, 100, 34, 35, 36, 98, 25, 26, 27, 97, 28, 29, 30, 99, 31, 32, 33, 44, 45, 99, 46, 47, 48, 97, 37, 38, 39, 100, 40, 41, 42, 98, 43, 97, 55, 56, 57, 98, 58, 59, 60, 100, 49, 50, 51, 99, 52, 53, 54, 65, 66, 98, 67, 68, 69, 99, 70, 71, 72, 97, 61, 62, 63, 100, 64, 99, 76, 77, 78, 97, 79, 80, 81, 100, 82, 83, 84, 98, 73, 74, 75, 86, 87, 98, 88, 89, 90, 100, 91, 92, 93, 97, 94, 95, 96, 99, 85)
aug8x16adj2nonran1.plan$trt <- c(99, 1, 2, 3, 97, 4, 5, 6, 100, 7, 8, 9, 98, 10, 11, 12, 23, 24, 100, 13, 14, 15, 98, 16, 17, 18, 99, 19, 20, 21, 97, 22, 98, 34, 35, 36, 97, 25, 26, 27, 99, 28, 29, 30, 100, 31, 32, 33, 44, 45, 97, 46, 47, 48, 100, 37, 38, 39, 98, 40, 41, 42, 99, 43, 100, 55, 56, 57, 99, 58, 59, 60, 97, 49, 50, 51, 98, 52, 53, 54, 65, 66, 97, 67, 68, 69, 100, 70, 71, 72, 98, 61, 62, 63, 99, 64, 98, 76, 77, 78, 99, 79, 80, 81, 97, 82, 83, 84, 100, 73, 74, 75, 86, 87, 99, 88, 89, 90, 98, 91, 92, 93, 100, 94, 95, 96, 97, 85)
aug8x16adj2nonran1.sim <- simulate.plan(aug8x16adj2nonran1.plan,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)
```


```{r}
aug8x16adj2nonran1.sim$points$check <- as.factor(aug8x16adj2nonran1.sim$points$trt %in% checks)
ggplot(aug8x16adj2nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = trt),size=1)
ggplot(aug8x16adj2nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = check),size=1)
```


### Distances
```{r}
aug8x16adj0nonran1.plan$rep <- aug8x16adj0nonran1.plan$row
aug8x16adj0nonran1.pairs.dat <- pair.distances(aug8x16adj0nonran1.plan, plot.dim=arm.plot.dim, row.buffer=arm.row.buffer)

aug8x16adj1nonran1.plan$rep <- aug8x16adj1nonran1.plan$row
aug8x16adj1nonran1.pairs.dat <- pair.distances(aug8x16adj1nonran1.plan, plot.dim=arm.plot.dim, row.buffer=arm.row.buffer)

aug8x16adj2nonran1.plan$rep <- aug8x16adj2nonran1.plan$row
aug8x16adj2nonran1.pairs.dat <- pair.distances(aug8x16adj2nonran1.plan, plot.dim=arm.plot.dim, row.buffer=arm.row.buffer)

aug8x16adj0nonran0.plan$rep <- aug8x16adj0nonran0.plan$row
aug8x16adj0nonran0.pairs.dat <- pair.distances(aug8x16adj0nonran0.plan, plot.dim=arm.plot.dim, row.buffer=arm.row.buffer)

aug8x16adj0nonran0b.plan$rep <- aug8x16adj0nonran0b.plan$row
aug8x16adj0nonran0b.pairs.dat <- pair.distances(aug8x16adj0nonran0b.plan, plot.dim=arm.plot.dim, row.buffer=arm.row.buffer)
```


We have three classes of pairwise comparisons.
```{r}
aug8x16adj0nonran1.pairs.dat$pair.type <- "mixed"
check.mask <- 
aug8x16adj0nonran1.pairs.dat$pair.type[aug8x16adj0nonran1.pairs.dat$trt1 %in% checks & aug8x16adj0nonran1.pairs.dat$trt2 %in% checks] <- "check"
aug8x16adj0nonran1.pairs.dat$pair.type[!(aug8x16adj0nonran1.pairs.dat$trt1 %in% checks) & !(aug8x16adj0nonran1.pairs.dat$trt2 %in% checks)] <- "unrep"
aug8x16adj0nonran1.pairs.dat$pair.type <- as.factor(aug8x16adj0nonran1.pairs.dat$pair.type)

aug8x16adj1nonran1.pairs.dat$pair.type <- "mixed"
check.mask <- 
aug8x16adj1nonran1.pairs.dat$pair.type[aug8x16adj1nonran1.pairs.dat$trt1 %in% checks & aug8x16adj1nonran1.pairs.dat$trt2 %in% checks] <- "check"
aug8x16adj1nonran1.pairs.dat$pair.type[!(aug8x16adj1nonran1.pairs.dat$trt1 %in% checks) & !(aug8x16adj1nonran1.pairs.dat$trt2 %in% checks)] <- "unrep"
aug8x16adj1nonran1.pairs.dat$pair.type <- as.factor(aug8x16adj1nonran1.pairs.dat$pair.type)

aug8x16adj2nonran1.pairs.dat$pair.type <- "mixed"
check.mask <- 
aug8x16adj2nonran1.pairs.dat$pair.type[aug8x16adj2nonran1.pairs.dat$trt1 %in% checks & aug8x16adj2nonran1.pairs.dat$trt2 %in% checks] <- "check"
aug8x16adj2nonran1.pairs.dat$pair.type[!(aug8x16adj2nonran1.pairs.dat$trt1 %in% checks) & !(aug8x16adj2nonran1.pairs.dat$trt2 %in% checks)] <- "unrep"
aug8x16adj2nonran1.pairs.dat$pair.type <- as.factor(aug8x16adj2nonran1.pairs.dat$pair.type)


aug8x16adj0nonran0.pairs.dat$pair.type <- "mixed"
check.mask <- 
aug8x16adj0nonran0.pairs.dat$pair.type[aug8x16adj0nonran0.pairs.dat$trt1 %in% checks & aug8x16adj0nonran0.pairs.dat$trt2 %in% checks] <- "check"
aug8x16adj0nonran0.pairs.dat$pair.type[!(aug8x16adj0nonran0.pairs.dat$trt1 %in% checks) & !(aug8x16adj0nonran0.pairs.dat$trt2 %in% checks)] <- "unrep"
aug8x16adj0nonran0.pairs.dat$pair.type <- as.factor(aug8x16adj0nonran0.pairs.dat$pair.type)


aug8x16adj0nonran0b.pairs.dat$pair.type <- "mixed"
check.mask <- 
aug8x16adj0nonran0b.pairs.dat$pair.type[aug8x16adj0nonran0b.pairs.dat$trt1 %in% checks & aug8x16adj0nonran0b.pairs.dat$trt2 %in% checks] <- "check"
aug8x16adj0nonran0b.pairs.dat$pair.type[!(aug8x16adj0nonran0b.pairs.dat$trt1 %in% checks) & !(aug8x16adj0nonran0b.pairs.dat$trt2 %in% checks)] <- "unrep"
aug8x16adj0nonran0b.pairs.dat$pair.type <- as.factor(aug8x16adj0nonran0b.pairs.dat$pair.type)
```

Types of comparisons
--------------------

We have three classes of treatment pairs - Among checks, among unreplicated and between checks and unreplicated. We also have two groupings - within replicates only and across replicates.

We have 6 combinations from with to compute average contrast distances.

To summarize by treatment, we have checks and unreplicated, we can sum
checks among checks, checks among untreated, checks across all, 

### All pairs
```{r}
tapply(aug8x16adj0nonran1.pairs.dat$distance,aug8x16adj0nonran1.pairs.dat$pair.type,mean)
tapply(aug8x16adj1nonran1.pairs.dat$distance,aug8x16adj1nonran1.pairs.dat$pair.type,mean)
tapply(aug8x16adj2nonran1.pairs.dat$distance,aug8x16adj2nonran1.pairs.dat$pair.type,mean)
tapply(aug8x16adj0nonran0.pairs.dat$distance,aug8x16adj0nonran0.pairs.dat$pair.type,mean)
tapply(aug8x16adj0nonran0b.pairs.dat$distance,aug8x16adj0nonran0b.pairs.dat$pair.type,mean)

tapply(aug8x16adj0nonran1.pairs.dat$distance,aug8x16adj0nonran1.pairs.dat$pair.type,sd)
tapply(aug8x16adj1nonran1.pairs.dat$distance,aug8x16adj1nonran1.pairs.dat$pair.type,sd)
tapply(aug8x16adj2nonran1.pairs.dat$distance,aug8x16adj2nonran1.pairs.dat$pair.type,sd)
tapply(aug8x16adj0nonran0.pairs.dat$distance,aug8x16adj0nonran0.pairs.dat$pair.type,sd)
tapply(aug8x16adj0nonran0b.pairs.dat$distance,aug8x16adj0nonran0b.pairs.dat$pair.type,sd)
```

```{r}
ggplot(aug8x16adj0nonran1.pairs.dat, aes(distance, fill=pair.type)) + geom_histogram(bins=6)
ggplot(aug8x16adj1nonran1.pairs.dat, aes(distance, fill=pair.type)) + geom_histogram(bins=6)
ggplot(aug8x16adj2nonran1.pairs.dat, aes(distance, fill=pair.type)) + geom_histogram(bins=6)
ggplot(aug8x16adj0nonran0.pairs.dat, aes(distance, fill=pair.type)) + geom_histogram(bins=6)
ggplot(aug8x16adj0nonran0b.pairs.dat, aes(distance, fill=pair.type)) + geom_histogram(bins=6)
```

To compute means for treatments, 

```{r}
aug8x16adj2nonran1.pairs.table <- make.pairs.table(aug8x16adj2nonran1.pairs.dat)
aug8x16adj2nonran1.mat <- make.pairs.matrices(aug8x16adj2nonran1.pairs.table)


aug8x16adj0nonran1.pairs.table <- make.pairs.table(aug8x16adj0nonran1.pairs.dat)
aug8x16adj0nonran1.mat <- make.pairs.matrices(aug8x16adj0nonran1.pairs.table)

aug8x16adj0nonran0.pairs.table <- make.pairs.table(aug8x16adj0nonran0.pairs.dat)
aug8x16adj0nonran0.mat <- make.pairs.matrices(aug8x16adj0nonran0.pairs.table)

aug8x16adj0nonran0b.pairs.table <- make.pairs.table(aug8x16adj0nonran0b.pairs.dat)
aug8x16adj0nonran0b.mat <- make.pairs.matrices(aug8x16adj0nonran0b.pairs.table)

aug8x16adj1nonran1.pairs.table <- make.pairs.table(aug8x16adj1nonran1.pairs.dat)
aug8x16adj1nonran1.mat <- make.pairs.matrices(aug8x16adj1nonran1.pairs.table)

aug8x16adj2nonran1.pairs.table <- make.pairs.table(aug8x16adj2nonran1.pairs.dat)
aug8x16adj2nonran1.mat <- make.pairs.matrices(aug8x16adj2nonran1.pairs.table)
```

Case 1
```{r}
aug8x16adj0nonran1.all <- rowMeans(aug8x16adj0nonran1.mat$mean,na.rm=TRUE)
aug8x16adj0nonran1.checks <- rowMeans(aug8x16adj0nonran1.mat$mean[,checks],na.rm=TRUE)
aug8x16adj0nonran1.unrep <- rowMeans(aug8x16adj0nonran1.mat$mean[,unreplicated],na.rm=TRUE)


aug8x16adj0nonran0.all <- rowMeans(aug8x16adj0nonran0.mat$mean,na.rm=TRUE)
aug8x16adj0nonran0.checks <- rowMeans(aug8x16adj0nonran0.mat$mean[,checks],na.rm=TRUE)
aug8x16adj0nonran0.unrep <- rowMeans(aug8x16adj0nonran0.mat$mean[,unreplicated],na.rm=TRUE)

aug8x16adj0nonran0b.all <- rowMeans(aug8x16adj0nonran0b.mat$mean,na.rm=TRUE)
aug8x16adj0nonran0b.checks <- rowMeans(aug8x16adj0nonran0b.mat$mean[,checks],na.rm=TRUE)
aug8x16adj0nonran0b.unrep <- rowMeans(aug8x16adj0nonran0b.mat$mean[,unreplicated],na.rm=TRUE)


aug8x16adj1nonran1.all <- rowMeans(aug8x16adj1nonran1.mat$mean,na.rm=TRUE)
aug8x16adj1nonran1.checks <- rowMeans(aug8x16adj1nonran1.mat$mean[,checks],na.rm=TRUE)
aug8x16adj1nonran1.unrep <- rowMeans(aug8x16adj1nonran1.mat$mean[,unreplicated],na.rm=TRUE)


aug8x16adj2nonran1.all <- rowMeans(aug8x16adj2nonran1.mat$mean,na.rm=TRUE)
aug8x16adj2nonran1.checks <- rowMeans(aug8x16adj2nonran1.mat$mean[,checks],na.rm=TRUE)
aug8x16adj2nonran1.unrep <- rowMeans(aug8x16adj2nonran1.mat$mean[,unreplicated],na.rm=TRUE)

```

```{r}
distances <- c()
adjacency <- c()
grouping <- c()
across <- c()
treatments <- c()
nonran <- c()
twiddled <- c()


distances <- c(distances,aug8x16adj0nonran1.all)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran1.all)))
grouping <- c(grouping,rep("All",length(aug8x16adj0nonran1.all)))
across <- c(across,rep(TRUE,length(aug8x16adj0nonran1.all)))
nonran <- c(nonran,rep(1,length(aug8x16adj0nonran1.all)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)
distances <- c(distances,aug8x16adj0nonran1.checks)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran1.checks)))
grouping <- c(grouping,rep("Checks",length(aug8x16adj0nonran1.checks)))
across <- c(across,rep(TRUE,length(aug8x16adj0nonran1.checks)))
nonran <- c(nonran,rep(1,length(aug8x16adj0nonran1.checks)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)
distances <- c(distances,aug8x16adj0nonran1.unrep)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran1.unrep)))
grouping <- c(grouping,rep("Unreplicated",length(aug8x16adj0nonran1.unrep)))
across <- c(across,rep(TRUE,length(aug8x16adj0nonran1.unrep)))
nonran <- c(nonran,rep(1,length(aug8x16adj0nonran1.unrep)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)


distances <- c(distances,aug8x16adj1nonran1.all)
adjacency <- c(adjacency,rep(1,length(aug8x16adj1nonran1.all)))
grouping <- c(grouping,rep("All",length(aug8x16adj1nonran1.all)))
across <- c(across,rep(TRUE,length(aug8x16adj1nonran1.all)))
nonran <- c(nonran,rep(1,length(aug8x16adj1nonran1.all)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj2nonran1.all)
adjacency <- c(adjacency,rep(2,length(aug8x16adj2nonran1.all)))
grouping <- c(grouping,rep("All",length(aug8x16adj2nonran1.all)))
across <- c(across,rep(TRUE,length(aug8x16adj2nonran1.all)))
nonran <- c(nonran,rep(1,length(aug8x16adj2nonran1.all)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)





distances <- c(distances,aug8x16adj1nonran1.checks)
adjacency <- c(adjacency,rep(1,length(aug8x16adj1nonran1.checks)))
grouping <- c(grouping,rep("Checks",length(aug8x16adj1nonran1.checks)))
across <- c(across,rep(TRUE,length(aug8x16adj1nonran1.checks)))
nonran <- c(nonran,rep(1,length(aug8x16adj1nonran1.checks)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj2nonran1.checks)
adjacency <- c(adjacency,rep(2,length(aug8x16adj2nonran1.checks)))
grouping <- c(grouping,rep("Checks",length(aug8x16adj2nonran1.checks)))
across <- c(across,rep(TRUE,length(aug8x16adj2nonran1.checks)))
nonran <- c(nonran,rep(1,length(aug8x16adj2nonran1.checks)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)



distances <- c(distances,aug8x16adj1nonran1.unrep)
adjacency <- c(adjacency,rep(1,length(aug8x16adj1nonran1.unrep)))
grouping <- c(grouping,rep("Unreplicated",length(aug8x16adj1nonran1.unrep)))
across <- c(across,rep(TRUE,length(aug8x16adj1nonran1.unrep)))
nonran <- c(nonran,rep(1,length(aug8x16adj1nonran1.unrep)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj2nonran1.unrep)
adjacency <- c(adjacency,rep(2,length(aug8x16adj2nonran1.unrep)))
grouping <- c(grouping,rep("Unreplicated",length(aug8x16adj2nonran1.unrep)))
across <- c(across,rep(TRUE,length(aug8x16adj2nonran1.unrep)))
nonran <- c(nonran,rep(1,length(aug8x16adj2nonran1.unrep)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)


distances <- c(distances,aug8x16adj0nonran0.all)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0.all)))
grouping <- c(grouping,rep("All",length(aug8x16adj0nonran0.all)))
across <- c(across,rep(TRUE,length(aug8x16adj0nonran0.all)))
nonran <- c(nonran,rep(0,length(aug8x16adj0nonran0.all)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj0nonran0.checks)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0.checks)))
grouping <- c(grouping,rep("Checks",length(aug8x16adj0nonran0.checks)))
across <- c(across,rep(TRUE,length(aug8x16adj0nonran0.checks)))
nonran <- c(nonran,rep(0,length(aug8x16adj0nonran0.checks)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj0nonran0.unrep)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0.unrep)))
grouping <- c(grouping,rep("Unreplicated",length(aug8x16adj0nonran0.unrep)))
across <- c(across,rep(TRUE,length(aug8x16adj0nonran0.unrep)))
nonran <- c(nonran,rep(0,length(aug8x16adj0nonran0.unrep)))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj0nonran0b.all)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0b.all)))
grouping <- c(grouping,rep("All",length(aug8x16adj0nonran0b.all)))
across <- c(across,rep(TRUE,length(aug8x16adj0nonran0b.all)))
nonran <- c(nonran,rep(0,length(aug8x16adj0nonran0b.all)))
twiddled <- c(twiddled,rep(TRUE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj0nonran0b.checks)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0b.checks)))
grouping <- c(grouping,rep("Checks",length(aug8x16adj0nonran0b.checks)))
across <- c(across,rep(TRUE,length(aug8x16adj0nonran0b.checks)))
nonran <- c(nonran,rep(0,length(aug8x16adj0nonran0b.checks)))
twiddled <- c(twiddled,rep(TRUE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj0nonran0b.unrep)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0b.unrep)))
grouping <- c(grouping,rep("Unreplicated",length(aug8x16adj0nonran0b.unrep)))
across <- c(across,rep(TRUE,length(aug8x16adj0nonran0b.unrep)))
nonran <- c(nonran,rep(0,length(aug8x16adj0nonran0b.unrep)))
twiddled <- c(twiddled,rep(TRUE,100))
treatments <- c(treatments,1:100)
```


### Within replicate

```{r}
aug8x16adj0nonran1.pairs.rep.dat <- subset(aug8x16adj0nonran1.pairs.dat,aug8x16adj0nonran1.pairs.dat$rep1==aug8x16adj0nonran1.pairs.dat$rep2)
ggplot(aug8x16adj0nonran1.pairs.rep.dat, aes(distance, fill=pair.type)) + geom_histogram(bins=6)

aug8x16adj1nonran1.pairs.rep.dat <- subset(aug8x16adj1nonran1.pairs.dat,aug8x16adj1nonran1.pairs.dat$rep1==aug8x16adj1nonran1.pairs.dat$rep2)
ggplot(aug8x16adj1nonran1.pairs.rep.dat, aes(distance, fill=pair.type)) + geom_histogram(bins=6)

aug8x16adj2nonran1.pairs.rep.dat <- subset(aug8x16adj2nonran1.pairs.dat,aug8x16adj2nonran1.pairs.dat$rep1==aug8x16adj2nonran1.pairs.dat$rep2)
ggplot(aug8x16adj2nonran1.pairs.rep.dat, aes(distance, fill=pair.type)) + geom_histogram(bins=6)

aug8x16adj0nonran0.pairs.rep.dat <- subset(aug8x16adj0nonran0.pairs.dat,aug8x16adj0nonran0.pairs.dat$rep1==aug8x16adj0nonran0.pairs.dat$rep2)
ggplot(aug8x16adj0nonran0.pairs.rep.dat, aes(distance, fill=pair.type)) + geom_histogram(bins=6)

aug8x16adj0nonran0b.pairs.rep.dat <- subset(aug8x16adj0nonran0b.pairs.dat,aug8x16adj0nonran0b.pairs.dat$rep1==aug8x16adj0nonran0b.pairs.dat$rep2)
ggplot(aug8x16adj0nonran0b.pairs.rep.dat, aes(distance, fill=pair.type)) + geom_histogram(bins=6)

tapply(aug8x16adj0nonran1.pairs.rep.dat$distance,aug8x16adj0nonran1.pairs.rep.dat$pair.type,mean)
tapply(aug8x16adj0nonran0.pairs.rep.dat$distance,aug8x16adj0nonran0.pairs.rep.dat$pair.type,mean)
tapply(aug8x16adj0nonran0b.pairs.rep.dat$distance,aug8x16adj0nonran0b.pairs.rep.dat$pair.type,mean)
tapply(aug8x16adj1nonran1.pairs.rep.dat$distance,aug8x16adj1nonran1.pairs.rep.dat$pair.type,mean)
tapply(aug8x16adj2nonran1.pairs.rep.dat$distance,aug8x16adj2nonran1.pairs.rep.dat$pair.type,mean)

tapply(aug8x16adj0nonran1.pairs.dat$distance,aug8x16adj0nonran1.pairs.dat$pair.type,sd)
tapply(aug8x16adj0nonran0.pairs.dat$distance,aug8x16adj0nonran0.pairs.dat$pair.type,sd)
tapply(aug8x16adj0nonran0b.pairs.dat$distance,aug8x16adj0nonran0b.pairs.dat$pair.type,sd)
tapply(aug8x16adj1nonran1.pairs.dat$distance,aug8x16adj1nonran1.pairs.dat$pair.type,sd)
tapply(aug8x16adj2nonran1.pairs.dat$distance,aug8x16adj2nonran1.pairs.dat$pair.type,sd)
```


```{r}
aug8x16adj2nonran1.pairs.rep.table <- make.pairs.table(aug8x16adj2nonran1.pairs.rep.dat)
aug8x16adj2nonran1.rep.mat <- make.pairs.matrices(aug8x16adj2nonran1.pairs.rep.table)


#head(aug8x16adj2nonran1.rep.mat$mean)
#head(aug8x16adj2nonran1.rep.mat$sd)
#head(aug8x16adj2nonran1.rep.mat$count)

aug8x16adj0nonran1.pairs.rep.table <- make.pairs.table(aug8x16adj0nonran1.pairs.rep.dat)
aug8x16adj0nonran1.rep.mat <- make.pairs.matrices(aug8x16adj0nonran1.pairs.rep.table)

aug8x16adj0nonran0.pairs.rep.table <- make.pairs.table(aug8x16adj0nonran0.pairs.rep.dat)
aug8x16adj0nonran0.rep.mat <- make.pairs.matrices(aug8x16adj0nonran0.pairs.rep.table)

aug8x16adj0nonran0b.pairs.rep.table <- make.pairs.table(aug8x16adj0nonran0b.pairs.rep.dat)
aug8x16adj0nonran0b.rep.mat <- make.pairs.matrices(aug8x16adj0nonran0b.pairs.rep.table)

aug8x16adj1nonran1.pairs.rep.table <- make.pairs.table(aug8x16adj1nonran1.pairs.rep.dat)
aug8x16adj1nonran1.rep.mat <- make.pairs.matrices(aug8x16adj1nonran1.pairs.rep.table)

aug8x16adj2nonran1.pairs.rep.table <- make.pairs.table(aug8x16adj2nonran1.pairs.rep.dat)
aug8x16adj2nonran1.rep.mat <- make.pairs.matrices(aug8x16adj2nonran1.pairs.rep.table)

aug8x16adj0nonran1.rep.all <- rowMeans(aug8x16adj0nonran1.rep.mat$mean,na.rm=TRUE)
aug8x16adj0nonran1.rep.checks <- rowMeans(aug8x16adj0nonran1.rep.mat$mean[,checks],na.rm=TRUE)
aug8x16adj0nonran1.rep.unrep <- rowMeans(aug8x16adj0nonran1.rep.mat$mean[,unreplicated],na.rm=TRUE)

aug8x16adj0nonran0.rep.all <- rowMeans(aug8x16adj0nonran0.rep.mat$mean,na.rm=TRUE)
aug8x16adj0nonran0.rep.checks <- rowMeans(aug8x16adj0nonran0.rep.mat$mean[,checks],na.rm=TRUE)
aug8x16adj0nonran0.rep.unrep <- rowMeans(aug8x16adj0nonran0.rep.mat$mean[,unreplicated],na.rm=TRUE)

aug8x16adj0nonran0b.rep.all <- rowMeans(aug8x16adj0nonran0b.rep.mat$mean,na.rm=TRUE)
aug8x16adj0nonran0b.rep.checks <- rowMeans(aug8x16adj0nonran0b.rep.mat$mean[,checks],na.rm=TRUE)
aug8x16adj0nonran0b.rep.unrep <- rowMeans(aug8x16adj0nonran0b.rep.mat$mean[,unreplicated],na.rm=TRUE)

aug8x16adj1nonran1.rep.all <- rowMeans(aug8x16adj1nonran1.rep.mat$mean,na.rm=TRUE)
aug8x16adj1nonran1.rep.checks <- rowMeans(aug8x16adj1nonran1.rep.mat$mean[,checks],na.rm=TRUE)
aug8x16adj1nonran1.rep.unrep <- rowMeans(aug8x16adj1nonran1.rep.mat$mean[,unreplicated],na.rm=TRUE)


aug8x16adj2nonran1.rep.all <- rowMeans(aug8x16adj2nonran1.rep.mat$mean,na.rm=TRUE)
aug8x16adj2nonran1.rep.checks <- rowMeans(aug8x16adj2nonran1.rep.mat$mean[,checks],na.rm=TRUE)
aug8x16adj2nonran1.rep.unrep <- rowMeans(aug8x16adj2nonran1.rep.mat$mean[,unreplicated],na.rm=TRUE)
```



```{r}
distances <- c(distances,aug8x16adj0nonran1.rep.all)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran1.rep.all)))
grouping <- c(grouping,rep("All",length(aug8x16adj0nonran1.rep.all)))
across <- c(across,rep(FALSE,length(aug8x16adj0nonran1.rep.all)))
nonran <- c(nonran,rep(1,100))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)
distances <- c(distances,aug8x16adj0nonran1.rep.checks)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran1.rep.checks)))
grouping <- c(grouping,rep("Checks",length(aug8x16adj0nonran1.rep.checks)))
across <- c(across,rep(FALSE,length(aug8x16adj0nonran1.rep.checks)))
twiddled <- c(twiddled,rep(FALSE,100))
nonran <- c(nonran,rep(1,100))
treatments <- c(treatments,1:100)
distances <- c(distances,aug8x16adj0nonran1.rep.unrep)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran1.rep.unrep)))
grouping <- c(grouping,rep("Unreplicated",length(aug8x16adj0nonran1.rep.unrep)))
across <- c(across,rep(FALSE,length(aug8x16adj0nonran1.rep.unrep)))
twiddled <- c(twiddled,rep(FALSE,100))
nonran <- c(nonran,rep(1,100))
treatments <- c(treatments,1:100)


distances <- c(distances,aug8x16adj1nonran1.rep.all)
adjacency <- c(adjacency,rep(1,length(aug8x16adj1nonran1.rep.all)))
grouping <- c(grouping,rep("All",length(aug8x16adj1nonran1.rep.all)))
across <- c(across,rep(FALSE,length(aug8x16adj1nonran1.rep.all)))
nonran <- c(nonran,rep(1,100))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj2nonran1.rep.all)
adjacency <- c(adjacency,rep(2,length(aug8x16adj2nonran1.rep.all)))
grouping <- c(grouping,rep("All",length(aug8x16adj2nonran1.rep.all)))
across <- c(across,rep(FALSE,length(aug8x16adj2nonran1.rep.all)))
nonran <- c(nonran,rep(1,100))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)




distances <- c(distances,aug8x16adj1nonran1.rep.checks)
adjacency <- c(adjacency,rep(1,length(aug8x16adj1nonran1.rep.checks)))
grouping <- c(grouping,rep("Checks",length(aug8x16adj1nonran1.rep.checks)))
across <- c(across,rep(FALSE,length(aug8x16adj1nonran1.rep.checks)))
nonran <- c(nonran,rep(1,100))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj2nonran1.rep.checks)
adjacency <- c(adjacency,rep(2,length(aug8x16adj2nonran1.rep.checks)))
grouping <- c(grouping,rep("Checks",length(aug8x16adj2nonran1.rep.checks)))
across <- c(across,rep(FALSE,length(aug8x16adj2nonran1.rep.checks)))
nonran <- c(nonran,rep(1,100))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj1nonran1.rep.unrep)
adjacency <- c(adjacency,rep(1,length(aug8x16adj1nonran1.rep.unrep)))
grouping <- c(grouping,rep("Unreplicated",length(aug8x16adj1nonran1.rep.unrep)))
across <- c(across,rep(FALSE,length(aug8x16adj1nonran1.rep.unrep)))
nonran <- c(nonran,rep(1,100))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj2nonran1.rep.unrep)
adjacency <- c(adjacency,rep(2,length(aug8x16adj2nonran1.rep.unrep)))
grouping <- c(grouping,rep("Unreplicated",length(aug8x16adj2nonran1.rep.unrep)))
across <- c(across,rep(FALSE,length(aug8x16adj2nonran1.rep.unrep)))
nonran <- c(nonran,rep(1,100))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)


distances <- c(distances,aug8x16adj0nonran0.rep.all)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0.rep.all)))
grouping <- c(grouping,rep("All",length(aug8x16adj0nonran0.rep.all)))
across <- c(across,rep(FALSE,length(aug8x16adj0nonran0.rep.all)))
nonran <- c(nonran,rep(0,100))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj0nonran0.rep.checks)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0.rep.checks)))
grouping <- c(grouping,rep("Checks",length(aug8x16adj0nonran0.rep.checks)))
across <- c(across,rep(FALSE,length(aug8x16adj0nonran0.rep.checks)))
nonran <- c(nonran,rep(0,100))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj0nonran0.rep.unrep)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0.rep.unrep)))
grouping <- c(grouping,rep("Unreplicated",length(aug8x16adj0nonran0.rep.unrep)))
across <- c(across,rep(FALSE,length(aug8x16adj0nonran0.rep.unrep)))
nonran <- c(nonran,rep(0,100))
twiddled <- c(twiddled,rep(FALSE,100))
treatments <- c(treatments,1:100)


distances <- c(distances,aug8x16adj0nonran0b.rep.all)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0b.rep.all)))
grouping <- c(grouping,rep("All",length(aug8x16adj0nonran0b.rep.all)))
across <- c(across,rep(FALSE,length(aug8x16adj0nonran0b.rep.all)))
nonran <- c(nonran,rep(0,length(aug8x16adj0nonran0b.rep.all)))
twiddled <- c(twiddled,rep(TRUE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj0nonran0b.rep.checks)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0b.rep.checks)))
grouping <- c(grouping,rep("Checks",length(aug8x16adj0nonran0b.rep.checks)))
across <- c(across,rep(FALSE,length(aug8x16adj0nonran0b.rep.checks)))
nonran <- c(nonran,rep(0,length(aug8x16adj0nonran0b.rep.checks)))
twiddled <- c(twiddled,rep(TRUE,100))
treatments <- c(treatments,1:100)

distances <- c(distances,aug8x16adj0nonran0b.rep.unrep)
adjacency <- c(adjacency,rep(0,length(aug8x16adj0nonran0b.rep.unrep)))
grouping <- c(grouping,rep("Unreplicated",length(aug8x16adj0nonran0b.rep.unrep)))
across <- c(across,rep(FALSE,length(aug8x16adj0nonran0b.rep.unrep)))
nonran <- c(nonran,rep(0,length(aug8x16adj0nonran0b.rep.unrep)))
twiddled <- c(twiddled,rep(TRUE,100))
treatments <- c(treatments,1:100)
```

```{r}
comp.dat <- data.frame(
  distance = distances,
  adjacency = as.factor(adjacency),
  grouping = as.factor(grouping),
  across = as.factor(across),
  nonran = as.factor(nonran),
  twiddled = as.factor(twiddled),
  treatment = treatments
)
comp.dat$check <- comp.dat$treatment %in% checks
comp.dat$check <- as.factor(comp.dat$check)
comp.dat$class <-  comp.dat$grouping : comp.dat$adjacency : comp.dat$nonran : comp.dat$across
```



```{r}
ggplot(comp.dat, aes(distance,color=across,fill=across)) + geom_histogram(position="dodge")

ggplot(comp.dat, aes(distance,color=adjacency,fill=adjacency)) + stat_density(geom="line",position="identity")
ggplot(comp.dat, aes(distance,color=grouping,fill=grouping)) + stat_density(geom="line",position="identity")
ggplot(comp.dat, aes(distance,color=across,fill=across)) + stat_density(geom="line",position="identity")

ggplot(comp.dat, aes(distance,color=class,fill=class)) + stat_density(geom="line",position="identity")
```

### Slide 1
Compare checks in ranks, at edge and centered
```{r}
slide1.dat <- subset(comp.dat,comp.dat$adjacency==0)
slide1.dat <- subset(slide1.dat,slide1.dat$twiddled==FALSE)
slide1.dat <- subset(slide1.dat,slide1.dat$grouping=="Checks")
ggplot(slide1.dat, aes(distance,color=nonran,fill=nonran,linetype=across)) + stat_density(geom="line",position="identity",size=2)
ggplot(slide1.dat, aes(treatment, distance)) + geom_line(aes(color=nonran,linetype=across),size=1)
```

```{r}
slide1a.dat <- subset(comp.dat,comp.dat$adjacency==0)
slide1a.dat <- subset(slide1a.dat,slide1a.dat$twiddled==FALSE)
slide1a.dat <- subset(slide1a.dat,slide1a.dat$grouping=="All")
ggplot(slide1a.dat, aes(distance,color=nonran,fill=nonran,linetype=across)) + stat_density(geom="line",position="identity",size=2)
ggplot(slide1a.dat, aes(treatment, distance)) + geom_line(aes(color=nonran,linetype=across),size=1)
```

```{r}
slide2.dat <- subset(comp.dat,comp.dat$adjacency==0)
slide2.dat <- subset(slide2.dat,slide2.dat$grouping=="Checks")
#mask <- slide2.dat$twiddled==TRUE |  slide2.dat$nonran==1
slide2.dat <- subset(slide2.dat,slide2.dat$nonran==0)

ggplot(slide2.dat, aes(distance,color=twiddled,fill=twiddled,linetype=across)) + stat_density(geom="line",position="identity",size=1)
ggplot(slide2.dat, aes(treatment, distance)) + geom_line(aes(color=twiddled,linetype=across),size=1)
```


```{r}
slide2a.dat <- subset(comp.dat,comp.dat$adjacency==0)
slide2a.dat <- subset(slide2a.dat,slide2a.dat$grouping=="All")
slide2a.dat <- subset(slide2a.dat,slide2a.dat$nonran==0)
ggplot(slide2a.dat, aes(distance,color=twiddled,fill=twiddled,linetype=across)) + stat_density(geom="line",position="identity",size=1)
ggplot(slide2a.dat, aes(treatment, distance)) + geom_line(aes(color=twiddled,linetype=across),size=1)
```


```{r}
slide3.dat <- subset(comp.dat,comp.dat$nonran==1)
slide3.dat <- subset(slide3.dat,slide3.dat$twiddled==FALSE)
slide3.dat <- subset(slide3.dat,slide3.dat$grouping=="Checks")
ggplot(slide3.dat, aes(distance,color=adjacency,fill=adjacency,linetype=across)) + stat_density(geom="line",position="identity",size=2)
ggplot(slide3.dat, aes(treatment, distance)) + geom_line(aes(color=adjacency,linetype=across),size=1)
```

```{r}
slide3a.dat <- subset(comp.dat,comp.dat$nonran==1)
slide3a.dat <- subset(slide3a.dat,slide3a.dat$twiddled==FALSE)
slide3a.dat <- subset(slide3a.dat,slide3a.dat$grouping=="All")
ggplot(slide3a.dat, aes(distance,color=adjacency,fill=adjacency,linetype=across)) + stat_density(geom="line",position="identity",size=2)
ggplot(slide3a.dat, aes(treatment, distance)) + geom_line(aes(color=adjacency,linetype=across),size=1)
```


```{r}
ggplot(subset(comp.dat,comp.dat$grouping=="All"), aes(treatment, distance)) + geom_line(aes(color=adjacency,linetype=across),size=0.5)
ggplot(subset(comp.dat,comp.dat$grouping=="All"), aes(distance,color=adjacency,fill=class,linetype=across)) + stat_density(geom="line",position="identity",size=2)

ggplot(subset(comp.dat,comp.dat$grouping=="Checks"), aes(treatment, distance)) + geom_line(aes(color=adjacency,linetype=across),size=0.5)
ggplot(subset(comp.dat,comp.dat$grouping=="Checks"), aes(distance,color=adjacency,fill=class,linetype=across)) + stat_density(geom="line",position="identity",size=2)

ggplot(subset(comp.dat,comp.dat$grouping=="Unreplicated"), aes(treatment, distance)) + geom_line(aes(color=adjacency,linetype=across),size=0.5)
ggplot(subset(comp.dat,comp.dat$grouping=="Unreplicated"), aes(distance,color=adjacency,fill=class,linetype=across)) + stat_density(geom="line",position="identity",size=2)
```

```{r}
ggplot(subset(comp.dat,comp.dat$grouping=="All"), aes(distance,color=class,fill=class)) + stat_bin(aes(y = ..density.., geom="line", position="identity"))

```

```{r}
ggplot(subset(comp.dat,comp.dat$grouping=="All"), aes(x = distance)) +
  stat_density(aes(ymax = ..density..,  ymin = -..density..),
    fill = "grey50", colour = "grey50",
    geom = "ribbon", position = "identity") +
  facet_grid(. ~ class) +
  coord_flip()
```










aug16x7.plan <- data.frame(
row=c(1,1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5,5,6,6,6,6,6,6,6,7,7,7,7,7,7,7,8,8,8,8,8,8,8,9,9,9,9,9,9,9,10,10,10,10,10,10,10,11,11,11,11,11,11,11,12,12,12,12,12,12,12,13,13,13,13,13,13,13,14,14,14,14,14,14,14,15,15,15,15,15,15,15,16,16,16,16,16,16,16),
col=c(1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7)
)

plan14x7sw <- superimpose.plan(aug16x7.plan,
                           map.data=trimmed.dat,
                           start.point=c(3,3),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )

aug16x7.plan$blk <- ceiling(aug16x7.plan$row/2)
aug16x7adj0nonran1 <- aug16x7.plan
aug16x7adj0nonran1$trt <- as.factor(c(81,1,2,3,82,4,5,83,6,7,8,84,9,10,84,11,12,13,82,14,15,83,16,17,18,81,19,20,82,21,22,23,83,24,25,84,26,27,28,81,29,30,82,31,32,33,83,34,35,81,36,37,38,84,39,40,83,41,42,43,81,44,45,82,46,47,48,84,49,50,81,51,52,53,82,54,55,83,56,57,58,84,59,60,82,61,62,63,84,64,65,83,66,67,68,81,69,70,83,71,72,73,82,74,75,84,76,77,78,81,79,80))
  
aug16x7adj0nonran1.sim <- simulate.plan(aug16x7adj0nonran1,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)

aug16x7adj1nonran1 <- aug16x7.plan
aug16x7adj1nonran1$trt <- as.factor(c(81,1,2,3,82,4,5,10,83,6,7,8,84,9,14,15,82,11,12,13,83,81,19,20,84,16,17,18,23,84,24,25,83,21,22,27,28,81,29,30,82,26,31,32,33,84,34,35,83,81,36,37,38,82,39,40,45,84,41,42,43,83,44,49,50,82,46,47,48,81,83,54,55,84,51,52,53,58,81,59,60,82,56,57,62,63,84,64,65,83,61,66,67,68,81,69,70,82,81,71,72,73,84,74,75,80,82,76,77,78,83,79))

aug16x7adj1nonran1.sim <- simulate.plan(aug16x7adj1nonran1,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)

aug16x7adj2nonran1 <- aug16x7.plan
aug16x7adj2nonran1$trt <- as.factor(c(81,1,2,3,82,4,5,9,10,83,6,7,8,84,13,81,14,15,84,11,12,16,17,18,83,19,20,82,25,81,21,22,23,84,24,83,29,30,82,26,27,28,32,33,81,34,35,83,31,84,36,37,38,82,39,40,44,45,81,41,42,43,84,48,83,49,50,82,46,47,51,52,53,81,54,55,84,60,83,56,57,58,82,59,83,64,65,84,61,62,63,67,68,81,69,70,82,66,84,71,72,73,82,74,75,79,80,83,76,77,78,81))

aug16x7adj2nonran1.sim <- simulate.plan(aug16x7adj2nonran1,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)

aug16x7adj0nonran1.sim$points$check <- as.factor(aug16x7adj0nonran1.sim$points$trt %in% 81:84)

ggplot(aug16x7adj0nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = YldVolDry),size=1)
ggplot(aug16x7adj0nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = trt),size=1)
ggplot(aug16x7adj0nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = check),size=1)

aug16x7adj1nonran1.sim$points$check <- as.factor(aug16x7adj1nonran1.sim$points$trt %in% 81:84)

ggplot(aug16x7adj1nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = YldVolDry),size=1)
ggplot(aug16x7adj1nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = trt),size=1)
ggplot(aug16x7adj1nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = check),size=1)

aug16x7adj2nonran1.sim$points$check <- as.factor(aug16x7adj2nonran1.sim$points$trt %in% 81:84)

ggplot(aug16x7adj2nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = YldVolDry),size=1)
ggplot(aug16x7adj2nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = trt),size=1)
ggplot(aug16x7adj2nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = check),size=1)


### Block Size = 4

aug32x4.plan <- data.frame(
row=c(1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,22,22,22,22,23,23,23,23,24,24,24,24,25,25,25,25,26,26,26,26,27,27,27,27,28,28,28,28,29,29,29,29,30,30,30,30,31,31,31,31,32,32,32,32),
col=c(1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4)
)

plan32x4sw <- superimpose.plan(aug32x4.plan,
                           map.data=trimmed.dat,
                           start.point=c(3,3),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )


We should note very small differences in estimated plot yield for equivalent plots using the two plans.


head(plan8x14sw$plan)
head(plan14x7sw$plan)
head(plan32x4sw$plan)

aug32x4.plan$blk <- ceiling(aug32x4.plan$row/4)


aug32x4adj0nonran1 <- aug32x4.plan
aug32x4adj0nonran1$trt <- as.factor(c(81,1,2,3,82,4,5,6,83,7,8,9,84,10,11,12,82,13,14,15,83,16,17,18,84,19,20,21,81,22,23,24,83,25,26,27,84,28,29,30,81,31,32,33,82,34,35,36,82,37,38,39,83,40,41,42,81,43,44,45,84,46,47,48,82,49,50,51,83,52,53,54,81,55,56,57,84,58,59,60,81,61,62,63,82,64,65,66,83,67,68,69,84,70,71,72,83,73,74,75,82,76,77,78,81,79,80,81,84,82,83,84,82,81,82,83,81,84,81,82,83,83,84,81,84,82,83,84))
  
aug32x4adj0nonran1.sim <- simulate.plan(aug32x4adj0nonran1,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)

aug32x4adj1nonran1 <- aug32x4.plan
aug32x4adj1nonran1$trt <- as.factor(c(81,1,2,3,6,82,4,5,8,9,83,7,10,11,12,84,82,13,14,15,18,84,16,17,20,21,81,19,22,23,24,83,83,25,26,27,30,84,28,29,32,33,81,31,34,35,36,82,84,37,38,39,42,81,40,41,44,45,83,43,46,47,48,82,82,49,50,51,54,81,52,53,56,57,84,55,58,59,60,83,81,61,62,63,66,84,64,65,68,69,82,67,70,71,72,83,82,73,74,75,78,81,76,77,80,81,83,79,82,83,84,84,83,81,82,83,82,81,84,81,84,81,82,83,82,83,84,84))

aug32x4adj1nonran1.sim <- simulate.plan(aug32x4adj1nonran1,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)

aug32x4adj2nonran1 <- aug32x4.plan
aug32x4adj2nonran1$trt <- as.factor(c(81,1,2,3,5,6,82,4,83,7,8,9,11,12,84,10,84,13,14,15,17,18,81,16,83,19,20,21,23,24,82,22,81,25,26,27,29,30,84,28,82,31,32,33,35,36,83,34,83,37,38,39,41,42,81,40,82,43,44,45,47,48,84,46,84,49,50,51,53,54,83,52,82,55,56,57,59,60,81,58,83,61,62,63,65,66,82,64,81,67,68,69,71,72,84,70,83,73,74,75,77,78,82,76,84,79,80,81,83,84,81,82,82,81,82,83,81,82,81,84,83,83,84,81,83,84,84,82))

aug32x4adj2nonran1.sim <- simulate.plan(aug32x4adj2nonran1,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)


aug32x4adj0nonran1.sim$points$check <- as.factor(aug32x4adj0nonran1.sim$points$trt %in% 81:84)

ggplot(aug32x4adj0nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = YldVolDry),size=1)
ggplot(aug32x4adj0nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = trt),size=1)
ggplot(aug32x4adj0nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = check),size=1)

aug32x4adj1nonran1.sim$points$check <- as.factor(aug32x4adj1nonran1.sim$points$trt %in% 81:84)

ggplot(aug32x4adj1nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = YldVolDry),size=1)
ggplot(aug32x4adj1nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = trt),size=1)
ggplot(aug32x4adj1nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = check),size=1)

aug32x4adj2nonran1.sim$points$check <- as.factor(aug32x4adj2nonran1.sim$points$trt %in% 81:84)

ggplot(aug32x4adj2nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = YldVolDry),size=1)
ggplot(aug32x4adj2nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = trt),size=1)
ggplot(aug32x4adj2nonran1.sim$points, aes(LonM, LatM)) + geom_point(aes(colour = check),size=1)


aug8x16adj0nonran1.sim$points$stagger <- 0
aug8x16adj1nonran1.sim$points$stagger <- 1
aug8x16adj2nonran1.sim$points$stagger <- 2
aug16x7adj0nonran1.sim$points$stagger <- 0
aug16x7adj1nonran1.sim$points$stagger <- 1
aug16x7adj2nonran1.sim$points$stagger <- 2
aug32x4adj0nonran1.sim$points$stagger <- 0
aug32x4adj1nonran1.sim$points$stagger <- 1
aug32x4adj2nonran1.sim$points$stagger <- 2

aug8x16adj0nonran1.sim$points$blocksize <- 14
aug8x16adj1nonran1.sim$points$blocksize <- 14
aug8x16adj2nonran1.sim$points$blocksize <- 14
aug16x7adj0nonran1.sim$points$blocksize <- 7
aug16x7adj1nonran1.sim$points$blocksize <- 7
aug16x7adj2nonran1.sim$points$blocksize <- 7
aug32x4adj0nonran1.sim$points$blocksize <- 4
aug32x4adj1nonran1.sim$points$blocksize <- 4
aug32x4adj2nonran1.sim$points$blocksize <- 4

comparison.dat <- rbind(aug8x16adj0nonran1.sim$points,
                        aug8x16adj1nonran1.sim$points,
                        aug8x16adj2nonran1.sim$points,
                        aug16x7adj0nonran1.sim$points,
                        aug16x7adj1nonran1.sim$points,
                        aug16x7adj2nonran1.sim$points,
                        aug32x4adj0nonran1.sim$points,
                        aug32x4adj1nonran1.sim$points,
                        aug32x4adj2nonran1.sim$points)
comparison.dat$blocksize <- as.factor(comparison.dat$blocksize)
comparison.dat$stagger <- as.factor(comparison.dat$stagger)
comparison.dat$number <- as.factor(comparison.dat$number)
comparison.dat$blk <- as.factor(comparison.dat$blk)
comparison.dat <- subset(comparison.dat,comparison.dat$trt %in% checks)
comparison.dat$experiment <- comparison.dat$number:comparison.dat$blocksize:comparison.dat$stagger


summary(aov(YldVolDry ~ trt*blocksize*stagger + experiment + experiment:blk,data=comparison.dat))
library(lme4)
comp.reml <- lmer(YldVolDry ~ trt*blocksize*stagger + (1| experiment/blk), data=comparison.dat)
summary(comp.reml)



plan16x7.plan <- plan8x14.plan
plan16x7.plan$row=aug14_7.plan$row
plan16x7.plan$col=aug14_7.plan$col


plan16x7.plan$blk <- ceiling(plan16x7.plan$row/2)

stag.vanes7 <- simulate.plan(plan16x7.plan,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)

ggplot(stag.vanes7$aov, aes(Row, Col)) + geom_point(aes(colour = RepP),size = 8)
ggplot(stag.vanes7$aov, aes(Row, Col)) + geom_point(aes(colour = ResMS),size = 8)
ggplot(stag.vanes7$aov, aes(Row, Col)) + geom_point(aes(colour = TrtP),size = 8)

hist(stag.vanes7$aov$TrtMS)
hist(stag.vanes7$aov$TrtP)
hist(stag.vanes7$aov$RepMS)
hist(stag.vanes7$aov$RepP)
hist(stag.vanes7$aov$ResMS)

max(aug8x16adj0nonran1.sim$aov$Row)
max(aug8x16adj0nonran1.sim$aov$Col)

max(aug16x7adj0nonran1.sim$aov$Row)
max(aug16x7adj0nonran1.sim$aov$Col)


8 rows by 14 columns 
vanEs14x8
aug80v140n, etc.


max(stag.vanes7$aov$Row)
max(stag.vanes7$aov$Col)

plan8x14sw <- superimpose.plan(plan8x14.plan,
                           map.data=trimmed.dat,
                           start.point=c(3,3),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )
#plan8x14sw$plan

plan8x14se <- superimpose.plan(plan8x14.plan,
                           map.data=trimmed.dat,
                           start.point=c(211,513),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )
#plan8x14se$plan

plan8x14nw <- superimpose.plan(plan8x14.plan,
                           map.data=trimmed.dat,
                           start.point=c(3,3),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )
#plan8x14nw$plan

plan8x14ne <- superimpose.plan(plan8x14.plan,
                           map.data=trimmed.dat,
                           start.point=c(211,513),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )
#plan8x14ne$plan

stag.vanes7 <- simulate.plan(plan16x7.plan,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)
max(stag.vanes7$aov$Row)
max(stag.vanes7$aov$Col)


plan16x7sw <- superimpose.plan(plan16x7.plan,
                           map.data=trimmed.dat,
                           start.point=c(3,3),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )
#plan16x7sw$plan

plan16x7nw <- superimpose.plan(plan16x7.plan,
                           map.data=trimmed.dat,
                           start.point=c(211,3),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )
#plan16x7nw$plan

plan16x7se <- superimpose.plan(plan16x7.plan,
                           map.data=trimmed.dat,
                           start.point=c(3,513),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )
#plan16x7se$plan

plan16x7ne <- superimpose.plan(plan16x7.plan,
                           map.data=trimmed.dat,
                           start.point=c(211,513),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )
#plan16x7ne$plan

plan32x4.plan <- data.frame(
row=c(1,1,1,1,2,2,2,2,3,3,3,3,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,9,9,9,9,10,10,10,10,11,11,11,11,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,21,21,21,21,22,22,22,22,23,23,23,23,24,24,25,25,25,25,26,26,26,26,27,27,27,27,28,28,29,29,29,29,30,30,30,30,31,31,31,31,32,32),
col=c(1,2,3,4,1,2,3,4,1,2,3,4,1,2,1,2,3,4,1,2,3,4,1,2,3,4,1,2,1,2,3,4,1,2,3,4,1,2,3,4,1,2,1,2,3,4,1,2,3,4,1,2,3,4,1,2,1,2,3,4,1,2,3,4,1,2,3,4,1,2,1,2,3,4,1,2,3,4,1,2,3,4,1,2,1,2,3,4,1,2,3,4,1,2,3,4,1,2,1,2,3,4,1,2,3,4,1,2,3,4,1,2),
trt=c(1,12,14,6,5,8,2,7,10,11,13,4,9,3,5,7,1,9,8,4,11,13,6,12,10,2,3,14,7,10,11,14,9,1,6,12,13,3,4,5,2,8,6,4,10,1,3,5,8,14,11,13,9,12,7,2,11,8,3,12,1,7,4,6,2,9,14,10,13,5,13,1,2,11,4,14,7,3,5,6,12,9,8,10,12,11,5,4,10,2,1,9,14,8,3,7,13,6,4,14,8,7,13,12,10,1,3,5,2,11,9,6))
plan32x4.plan$blk <- ceiling(plan32x4.plan$row/4)

stag.vanes4 <- simulate.plan(plan32x4.plan,trimmed.dat,plot.dim=arm.plot.dim,row.buffer=arm.row.buffer,sample.vgm=sample.vgm)

ggplot(stag.vanes4$aov, aes(Row, Col)) + geom_point(aes(colour = RepP),size = 8)
ggplot(stag.vanes4$aov, aes(Row, Col)) + geom_point(aes(colour = ResMS),size = 8)
ggplot(stag.vanes4$aov, aes(Row, Col)) + geom_point(aes(colour = TrtP),size = 8)

hist(stag.vanes4$aov$TrtMS)
hist(stag.vanes4$aov$TrtP)
hist(stag.vanes4$aov$RepMS)
hist(stag.vanes4$aov$RepP)
hist(stag.vanes4$aov$ResMS)

max(stag.vanes4$aov$Row)
max(stag.vanes4$aov$Col)

plan32x4sw <- superimpose.plan(plan32x4.plan,
                           map.data=trimmed.dat,
                           start.point=c(3,3),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )

#plan32x4sw$plan



plan32x4nw <- superimpose.plan(plan32x4.plan,
                           map.data=trimmed.dat,
                           start.point=c(3,498),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )
#plan32x4nw$plan

plan32x4ne <- superimpose.plan(plan32x4.plan,
                           map.data=trimmed.dat,
                           start.point=c(224,498),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )
#plan32x4ne$plan

plan32x4se <- superimpose.plan(plan32x4.plan,
                           map.data=trimmed.dat,
                           start.point=c(224,3),
                           plot.dim=arm.plot.dim,
                           row.buffer=arm.row.buffer,sample.vgm=sample.vgm
                           )
#plan32x4se$plan




